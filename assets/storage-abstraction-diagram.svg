<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 650" width="800" height="650">
  <!-- Background styles -->
  <style>
    .layer-box { fill: #fff; stroke: #2c3e50; stroke-width: 2; }
    .layer-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; text-anchor: middle; fill: #2c3e50; }
    .entity-box { fill: #ecf0f1; stroke: #34495e; stroke-width: 1.5; }
    .entity-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; fill: #34495e; }
    .constraint-box { fill: #e8f4f8; stroke: #3498db; stroke-width: 1.5; rx: 4; ry: 4; }
    .constraint-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; fill: #2980b9; }
    .constraint-property { font-family: Arial, sans-serif; font-size: 11px; fill: #34495e; }
    .collection-box { fill: #f8f9fa; stroke: #7f8c8d; stroke-width: 1.5; }
    .collection-title { font-family: Arial, sans-serif; font-size: 13px; font-weight: bold; text-anchor: middle; fill: #7f8c8d; }
    .document-box { fill: #f5f5f5; stroke: #95a5a6; stroke-width: 1; }
    .document-content { font-family: "Courier New", monospace; font-size: 9px; fill: #34495e; }
    .json-key { fill: #8e44ad; }
    .json-string { fill: #16a085; }
    .json-value { fill: #c0392b; }
    .arrow { stroke: #7f8c8d; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    .entity-relation { stroke: #3498db; stroke-width: 1.5; fill: none; marker-end: url(#relationhead); }
    .code-text { font-family: "Courier New", monospace; font-size: 11px; fill: #34495e; }
  </style>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="7" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7f8c8d"/>
    </marker>
    <marker id="relationhead" markerWidth="10" markerHeight="7" refX="7" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498db"/>
    </marker>
  </defs>

  <!-- Layer 1: Join Query API -->
  <rect x="100" y="40" width="600" height="110" class="layer-box"/>
  <text x="400" y="60" class="layer-title">Join Query API ($join)</text>
  <rect x="150" y="70" width="500" height="70" rx="4" ry="4" fill="#f7f9fb" stroke="#95a5a6" stroke-width="1"/>
  <text x="170" y="90" class="code-text">{ </text>
  <text x="180" y="105" class="code-text"><tspan class="json-key">"$inner"</tspan>: {</text>
  <text x="180" y="120" class="code-text">  <tspan class="json-key">"args"</tspan>: [<tspan class="json-string">"Customer"</tspan>, <tspan class="json-string">"Order"</tspan>],</text>
    <text x="200" y="135" class="code-text">  <tspan class="json-key">"condition"</tspan>: {<tspan class="json-key">"$gte":</tspan> [<tspan class="json-string">"$Order.amount"</tspan>, 100]}}}</text>

  <!-- Connection arrow -->
  <line x1="400" y1="150" x2="400" y2="188" class="arrow"/>

  <!-- Layer 2: Logical Schema -->
  <rect x="100" y="188" width="600" height="135" class="layer-box"/>
  <text x="400" y="208" class="layer-title">Logical Schema (Entity-Relationship Model)</text>

  <!-- Entity boxes -->
  <rect x="150" y="228" width="120" height="60" class="entity-box"/>
  <text x="210" y="258" class="entity-title">Customer</text>
  
  <rect x="340" y="228" width="120" height="60" class="entity-box"/>
  <text x="400" y="258" class="entity-title">Account</text>
  
  <rect x="530" y="228" width="120" height="60" class="entity-box"/>
  <text x="590" y="258" class="entity-title">Order</text>

  <!-- Entity relationships -->
  <line x1="270" y1="258" x2="340" y2="258" class="entity-relation"/>
  <line x1="460" y1="258" x2="530" y2="258" class="entity-relation"/>

  <!-- Connection arrow -->
  <line x1="400" y1="323" x2="400" y2="361" class="arrow"/>

  <!-- Layer 3: Storage Constraints -->
  <rect x="100" y="361" width="600" height="135" class="layer-box"/>
  <text x="400" y="381" class="layer-title">Storage Constraints Layer</text>

  <!-- Constraint boxes -->
  <rect x="130" y="396" width="260" height="85" class="constraint-box"/>
  <text x="260" y="411" class="constraint-title">Embedding Constraint</text>
  <text x="140" y="431" class="constraint-property"><tspan class="json-key">constraintType</tspan>: <tspan class="json-string">"Embedding"</tspan></text>
  <text x="140" y="446" class="constraint-property"><tspan class="json-key">direction</tspan>: <tspan class="json-string">"Child"</tspan></text>
  <text x="140" y="461" class="constraint-property"><tspan class="json-key">targetPath</tspan>: <tspan class="json-string">"contact"</tspan></text>
  <text x="140" y="476" class="constraint-property"><tspan class="json-key">projection</tspan>: [<tspan class="json-string">"name"</tspan>, <tspan class="json-string">"address"</tspan>]</text>

  <rect x="410" y="396" width="260" height="85" class="constraint-box"/>
  <text x="540" y="411" class="constraint-title">Embedding Constraint</text>
  <text x="420" y="431" class="constraint-property"><tspan class="json-key">constraintType</tspan>: <tspan class="json-string">"Embedding"</tspan></text>
  <text x="420" y="446" class="constraint-property"><tspan class="json-key">direction</tspan>: <tspan class="json-string">"Parent"</tspan></text>
  <text x="420" y="461" class="constraint-property"><tspan class="json-key">targetPath</tspan>: <tspan class="json-string">"invoice"</tspan></text>
  <text x="420" y="476" class="constraint-property"><tspan class="json-key">projection</tspan>: [<tspan class="json-string">"invoiceNumber"</tspan>, <tspan class="json-string">"amount"</tspan>]</text>

  <!-- Connection arrow -->
  <line x1="400" y1="496" x2="400" y2="534" class="arrow"/>

  <!-- Layer 4: Physical Collections -->
  <rect x="100" y="534" width="600" height="95" class="layer-box"/>
  <text x="400" y="554" class="layer-title">Physical Collections</text>

  <!-- Collection boxes -->
  <rect x="120" y="564" width="170" height="55" class="collection-box"/>
  <text x="205" y="579" class="collection-title">Customer Collection</text>
  <rect x="315" y="564" width="170" height="55" class="collection-box"/>
  <text x="400" y="579" class="collection-title">Account Collection</text>
  <rect x="510" y="564" width="170" height="55" class="collection-box"/>
  <text x="595" y="579" class="collection-title">Order Collection</text>

  <!-- Document indicators inside collections -->
  <rect x="130" y="584" width="150" height="25" class="document-box"/>
  <text x="205" y="599" class="document-content" text-anchor="middle">{ Customer data }</text>
  
  <rect x="325" y="584" width="150" height="25" class="document-box"/>
  <text x="400" y="599" class="document-content" text-anchor="middle">{ Account + Customer }</text>
  
  <rect x="520" y="584" width="150" height="25" class="document-box"/>
  <text x="595" y="599" class="document-content" text-anchor="middle">{ Order + Account }</text>
</svg>
